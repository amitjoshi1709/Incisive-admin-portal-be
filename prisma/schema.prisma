generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public"]
}

model audit_logs {
  id         String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String      @db.Uuid
  action     AuditAction
  resource   String?     @db.VarChar(255)
  details    Json?
  ip_address String?     @db.VarChar(45)
  user_agent String?
  created_at DateTime?   @default(now()) @db.Timestamp(6)
  users      users       @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([action], map: "idx_audit_logs_action")
  @@index([created_at], map: "idx_audit_logs_created_at")
  @@index([user_id], map: "idx_audit_logs_user_id")
  @@schema("public")
}

model dental_groups {
  dental_group_id      BigInt    @id
  name                 String
  dental_group_sfdc_id String?
  is_active            Boolean?  @default(true)
  created_at           DateTime? @default(now()) @db.Timestamp(6)
  updated_at           DateTime? @default(now()) @db.Timestamp(6)
  address              String?
  address_2            String?
  city                 String?
  state                String?
  zip                  String?
  account_type         String?
  centralized_billing  Boolean?
  sales_channel        String?
  sales_rep            String?

  @@schema("public")
}

model dental_practices {
  practice_id              BigInt                 @id
  dental_group_id          BigInt?
  dental_group_name        String?
  address                  String?
  address_2                String?
  city                     String?
  state                    String?
  zip                      String?
  phone                    String?
  clinical_email           String?
  billing_email            String?
  incisive_email           String?
  preferred_contact_method String?
  fee_schedule             String?
  status                   String?
  is_active                Boolean?               @default(true)
  created_at               DateTime?              @default(now()) @db.Timestamp(6)
  updated_at               DateTime?              @default(now()) @db.Timestamp(6)
  lab_practice_mapping     lab_practice_mapping[]

  @@schema("public")
}

model fee_schedules {
  schedule_name         String                  @id
  product_lab_rev_share product_lab_rev_share[]

  @@schema("public")
}

model incisive_product_catalog {
  incisive_id           Int                     @id
  incisive_name         String
  category              String?
  sub_category          String?
  is_active             Boolean?                @default(true)
  created_at            DateTime?               @default(now()) @db.Timestamp(6)
  updated_at            DateTime?               @default(now()) @db.Timestamp(6)
  lab_product_mapping   lab_product_mapping[]
  product_lab_markup    product_lab_markup[]
  product_lab_rev_share product_lab_rev_share[]

  @@schema("public")
}

model lab_practice_mapping {
  lab_practice_mapping_id BigInt           @id @default(autoincrement())
  lab_id                  BigInt
  practice_id             BigInt
  lab_practice_id         String?
  is_active               Boolean?         @default(true)
  created_at              DateTime?        @default(now()) @db.Timestamp(6)
  updated_at              DateTime?        @default(now()) @db.Timestamp(6)
  labs                    labs             @relation(fields: [lab_id], references: [lab_id], onDelete: NoAction, onUpdate: NoAction)
  dental_practices        dental_practices @relation(fields: [practice_id], references: [practice_id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("public")
}

model lab_product_mapping {
  lab_product_mapping_id   BigInt                    @id @default(autoincrement())
  lab_id                   BigInt?
  lab_product_id           String?
  lab_product_name         String?
  incisive_product_id      Int?
  is_active                Boolean?                  @default(true)
  created_at               DateTime?                 @default(now()) @db.Timestamp(6)
  updated_at               DateTime?                 @default(now()) @db.Timestamp(6)
  incisive_product_catalog incisive_product_catalog? @relation(fields: [incisive_product_id], references: [incisive_id], onDelete: NoAction, onUpdate: NoAction)
  labs                     labs?                     @relation(fields: [lab_id], references: [lab_id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model labs {
  lab_id                BigInt                  @id @default(autoincrement())
  lab_name              String
  lab_sfdc_id           String?
  partner_model         String?
  is_active             Boolean?                @default(true)
  created_at            DateTime?               @default(now()) @db.Timestamp(6)
  updated_at            DateTime?               @default(now()) @db.Timestamp(6)
  lab_practice_mapping  lab_practice_mapping[]
  lab_product_mapping   lab_product_mapping[]
  product_lab_markup    product_lab_markup[]
  product_lab_rev_share product_lab_rev_share[]

  @@schema("public")
}

model product_lab_markup {
  lab_id                   BigInt
  lab_product_id           String
  incisive_product_id      Int?
  cost                     Float?
  standard_price           Float?
  nf_price                 Float?
  commitment_eligible      Boolean?
  incisive_product_catalog incisive_product_catalog? @relation(fields: [incisive_product_id], references: [incisive_id], onDelete: NoAction, onUpdate: NoAction)
  labs                     labs                      @relation(fields: [lab_id], references: [lab_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([lab_id, lab_product_id])
  @@schema("public")
}

model product_lab_rev_share {
  lab_id                   BigInt
  lab_product_id           String
  incisive_product_id      Int?
  fee_schedule_name        String
  revenue_share            Float?
  commitment_eligible      Boolean?
  fee_schedules            fee_schedules             @relation(fields: [fee_schedule_name], references: [schedule_name], onDelete: NoAction, onUpdate: NoAction)
  incisive_product_catalog incisive_product_catalog? @relation(fields: [incisive_product_id], references: [incisive_id], onDelete: NoAction, onUpdate: NoAction)
  labs                     labs                      @relation(fields: [lab_id], references: [lab_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([lab_id, lab_product_id, fee_schedule_name])
  @@unique([lab_id, lab_product_id, fee_schedule_name], map: "unique_lab_product_fee_schedule")
  @@schema("public")
}

model users {
  id            String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email         String       @unique @db.VarChar(255)
  password      String       @db.VarChar(255)
  first_name    String       @db.VarChar(255)
  last_name     String       @db.VarChar(255)
  role          Role?        @default(USER)
  is_active     Boolean?     @default(true)
  refresh_token String?
  created_at    DateTime?    @default(now()) @db.Timestamp(6)
  updated_at    DateTime?    @default(now()) @db.Timestamp(6)
  audit_logs    audit_logs[]

  @@schema("public")
}

enum AuditAction {
  LOGIN
  LOGOUT
  CREATE_USER
  UPDATE_USER
  DELETE_USER
  CREATE_RECORD
  UPDATE_RECORD
  DELETE_RECORD

  @@schema("public")
}

enum Role {
  ADMIN
  USER
  VIEWER

  @@schema("public")
}
